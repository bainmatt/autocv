---
title: "An example resume generated with autocv"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An example resume generated with autocv}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(autocv)
```

# A reproducible example

The following end-to-end example runs in a temporary environment on your
local machine, constructing a project directory, an application directory,
a resume, and keyword reports, all from the `autocv`-supplied
example job posting, template datasets, and template stylesheets.

```{r reproducible-demo, eval=FALSE}
autocv::in_tmp_env({
  message("1. Build the project directory...")
  autocv::build_base_directory()
  
  data(example_job_metadata)
  app_df <- autocv::construct_app_metadata(app_info = example_job_metadata)

  message("")
  message("2. Build the application...")
  autocv::build_app_directory(app_df = app_df, open = FALSE)
  
  message("")
  message("3. Render the application...")
  # autocv::render_app(cover = FALSE, email = FALSE)
  autocv::render_resume_plain()

  message("")
  message("4. Check application keywords...")
  report_df <- autocv::check_skills()
  print(report_df)

  message("")
  message("5. Inspect application metadata...")
  app_df <- autocv::get_app_info()
  print(app_df)
})
```

# A step-by-step example

Let us now walk through each of these steps in greater depth,
keeping track of the evolving file tree
and copying the generated documents from the temporary environment
to your working directory, for your reference.

<!-- TODO: add brief interleaved explanations -->

## Step 1: Build the project directory

```{r build-base}
autocv::in_tmp_env({
  autocv::build_base_directory()
  
  data(example_job_metadata)
  app_df <- autocv::construct_app_metadata(app_info = example_job_metadata)
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Current file tree:")
  fs::dir_tree(autocv::get_path_to("applications"))
})

```

## Step 2: Build the application

```{r build-app}
autocv::in_tmp_env({
  autocv::build_app_directory(app_df = app_df, open = FALSE)
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Current file tree:")
  fs::dir_tree(autocv::get_path_to("applications"))
})

```

## Step 3: Render the application

```{r render-app}
autocv::in_tmp_env({
  # autocv::render_app(cover = FALSE, email = FALSE)
  autocv::render_resume_plain()
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Current file tree:")
  fs::dir_tree(autocv::get_path_to("applications"))
})

```

## Step 4: Check application keywords

```{r check}
autocv::in_tmp_env({
  report_df <- autocv::check_skills()
  print(report_df)
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Current file tree:")
  fs::dir_tree(autocv::get_path_to("applications"))
})

```

## Step 5: Inspect application metadata

```{r inspect}
autocv::in_tmp_env({
  app_df <- autocv::get_app_info()
  print(app_df)
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Current file tree:")
  fs::dir_tree(autocv::get_path_to("applications"))
})

```

## Review the generated documents

```{r log-files}
autocv::in_tmp_env({
  source_paths <- as.character(autocv::get_app_info(
    id = "AB",
    field = c(
      "resume_plain_path",
      "keyword_counts_posting",
      "skill_counts_posting",
      "skill_counts_resume",
      "skill_report"
    )
  )[2:6])
  target_dir <- file.path(fs::path_wd(), "output")
  if (!dir.exists(target_dir)) { dir.create(target_dir) }
  target_paths <- file.path(target_dir, basename(source_paths))
  
  autocv::copy_files(
    source_paths = source_paths,
    target_paths = target_paths
  )
})

```

```{r, echo=FALSE}
autocv::in_tmp_env({
  message("Working directory output file tree:")
  fs::dir_tree(file.path(fs::path_wd(), "output"))
})

```

```{r render-cv, eval=FALSE}
# NOTE: eval is off due to LaTeX rendering issues when running GitHub workflow
autocv::in_tmp_env({
  autocv::render_cv_as_html()
  autocv::render_resume()
})

```

<!-- TODO: list + link to the generated docs in repo -->

```{r log-base-files, eval=FALSE}
autocv::in_tmp_env({
  source_paths <- c(
    as.character(autocv::get_app_info(id = "AB", field = "resume_path")[2]),
    file.path(autocv::get_path_to("output"), "cv_yourname.html")
  )
  target_dir <- file.path(fs::path_wd(), "output")
  if (!dir.exists(target_dir)) { dir.create(target_dir) }
  target_paths <- file.path(target_dir, basename(source_paths))
  
  autocv::copy_files(
    source_paths = source_paths,
    target_paths = target_paths
  )
})

```

<!-- TODO: link to temp data files (source) in git repo on data doc pages -->
<!-- TODO: use explicit web hyperlinks in README -->
